function iniciarApp(){console.log("Iniciando app de gestión de clientes");const e=document.querySelector("#form-editar-cliente");e&&e.addEventListener("submit",actualizarCliente);const o=document.querySelectorAll(".editar-cliente");o.length>0&&o.forEach((e=>{e.addEventListener("click",mostrarModalEditar)}));const t=document.querySelectorAll(".eliminar-cliente");t.length>0&&t.forEach((e=>{e.addEventListener("click",confirmarEliminarCliente)}));const r=document.querySelector("#btn-cerrar-modal-cliente");r&&r.addEventListener("click",(()=>{document.querySelector("#modal-cliente").style.display="none"}))}function mostrarModalEditar(e){console.log("Mostrando modal de editar cliente");const o=e.currentTarget,t=o.dataset.id,r=o.dataset.nombre,a=o.dataset.apellido,n=o.dataset.email,l=o.dataset.telefono;console.log("Datos del cliente:",{id:t,nombre:r,apellido:a,email:n,telefono:l}),document.querySelector("#edit-cliente-id").value=t,document.querySelector("#edit-nombre").value=r,document.querySelector("#edit-apellido").value=a,document.querySelector("#edit-email").value=n,document.querySelector("#edit-telefono").value=l,document.querySelector("#modal-cliente").style.display="block"}async function actualizarCliente(e){e.preventDefault(),console.log("Actualizando cliente...");const o=new FormData(e.target);try{console.log("Enviando datos al servidor...");const e="/admin/actualizar-cliente",t=await fetch(e,{method:"POST",body:o});if(console.log("Respuesta recibida, estado:",t.status),!t.ok)throw new Error(`Error HTTP: ${t.status}`);const r=await t.text();let a;console.log("Respuesta del servidor (texto):",r);try{a=JSON.parse(r),console.log("Respuesta del servidor (JSON):",a)}catch(e){throw console.error("Error al parsear respuesta JSON:",e),console.error("Texto recibido:",r),new Error("La respuesta del servidor no es JSON válido")}a.resultado?(mostrarAlerta("Cliente actualizado correctamente","exito",".modal-contenido"),setTimeout((()=>{window.location.reload()}),2e3)):mostrarAlerta(a.mensaje||"Error al actualizar cliente","error",".modal-contenido")}catch(e){console.error("Error en try/catch:",e),mostrarAlerta(`Error: ${e.message}`,"error",".modal-contenido")}}function confirmarEliminarCliente(e){if(confirm("¿Estás seguro de eliminar este cliente? Esta acción no se puede deshacer y eliminará todas sus citas e información asociada.")){eliminarCliente(e.currentTarget.dataset.id)}}async function eliminarCliente(e){console.log("Eliminando cliente con ID:",e);try{const o=new FormData;o.append("id",e),console.log("Enviando solicitud para eliminar cliente...");const t="/admin/eliminar-cliente",r=await fetch(t,{method:"POST",body:o});if(console.log("Respuesta recibida, estado:",r.status),!r.ok)throw new Error(`Error HTTP: ${r.status}`);const a=await r.text();let n;console.log("Respuesta del servidor (texto):",a);try{n=JSON.parse(a),console.log("Respuesta del servidor (JSON):",n)}catch(e){throw console.error("Error al parsear respuesta JSON:",e),console.error("Texto recibido:",a),new Error("La respuesta del servidor no es JSON válido")}n.resultado?(mostrarAlerta("Cliente eliminado correctamente","exito",".listado-clientes"),setTimeout((()=>{window.location.reload()}),2e3)):mostrarAlerta(n.mensaje||"Error al eliminar cliente","error",".listado-clientes")}catch(e){console.error("Error en try/catch:",e),mostrarAlerta(`Error: ${e.message}`,"error",".listado-clientes")}}function mostrarAlerta(e,o,t){console.log("Mostrando alerta:",e,o,t);const r=document.querySelector(".alerta");r&&r.remove();const a=document.createElement("DIV");a.classList.add("alerta"),a.classList.add(o),a.textContent=e;const n=document.querySelector(t);if(!n)return console.error("Elemento de referencia no encontrado:",t),void document.body.prepend(a);n.parentElement?n.parentElement.insertBefore(a,n):(console.error("Elemento padre no encontrado para:",t),document.body.prepend(a)),setTimeout((()=>{a.remove()}),5e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));