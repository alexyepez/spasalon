function iniciarRecordatorios(){const e=document.querySelector("#form-crear-recordatorio"),o=document.querySelectorAll(".eliminar-recordatorio"),r=document.querySelectorAll(".enviar-recordatorio"),t=document.querySelectorAll(".boton-filtro"),a=document.querySelectorAll('a[href="/admin/recordatorios/enviar"]');a.length>0&&a.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),confirm("¿Deseas intentar enviar todos los recordatorios pendientes para hoy?")&&(mostrarAlerta("Enviando recordatorios, por favor espera...","exito",".contenedor-alertas"),fetch("/admin/recordatorios/ejecutar-envio",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((e=>{if(!e.ok)throw new Error("Error en la respuesta del servidor: "+e.status);return e.json()})).then((e=>{console.log("Respuesta del servidor:",e),e.resultado?(e.hayPendientes?mostrarAlerta(e.mensaje||"Recordatorios procesados exitosamente.","exito",".contenedor-alertas"):mostrarAlerta(e.mensaje||"No hay recordatorios pendientes para enviar.","info",".contenedor-alertas"),setTimeout((()=>{location.reload()}),3e3)):mostrarAlerta(e.mensaje||"Error al procesar los recordatorios pendientes.","error",".contenedor-alertas")})).catch((e=>{console.error("Error en la solicitud de enviar pendientes:",e),mostrarAlerta("Error de conexión al intentar enviar recordatorios pendientes: "+e.message,"error",".contenedor-alertas")})))}))}));const n=document.querySelector("#cliente_id"),i=document.querySelector("#cita_id");e&&e.addEventListener("submit",(function(e){})),o&&o.forEach((e=>{e.addEventListener("click",(function(){eliminarRecordatorio(this.dataset.id)}))})),r&&r.forEach((e=>{e.addEventListener("click",(function(){enviarRecordatorio(this.dataset.id)}))})),t&&t.forEach((e=>{e.addEventListener("click",(function(){aplicarFiltro(this.dataset.filtro),t.forEach((e=>e.classList.remove("activo"))),this.classList.add("activo")}))})),i&&i.addEventListener("change",mostrarDetallesCita),n&&i&&n.addEventListener("change",(function(){const e=this.value;Array.from(i.options).forEach(((o,r)=>{if(0===r)return;const t=o.textContent;""===e||t.includes(`Cliente: ${this.options[this.selectedIndex].textContent.trim()}`)?o.style.display="":o.style.display="none"})),i.value="";const o=document.getElementById("detalles-cita");o&&o.classList.add("oculto")}))}function aplicarFiltro(e){const o=document.querySelectorAll(".recordatorio");let r=0;o.forEach((o=>{"todos"===e?(o.style.display="flex",o.classList.contains("recordatorio-pendiente")&&r++):"pendientes"===e&&o.classList.contains("recordatorio-pendiente")?(o.style.display="flex",r++):"enviados"===e&&o.classList.contains("recordatorio-enviado")?o.style.display="flex":o.style.display="none"}));const t=document.querySelector('a.boton[href="/admin/recordatorios/enviar"]');t&&(0!==r||"pendientes"!==e&&"todos"!==e?(t.classList.remove("deshabilitado"),t.title="Enviar todos los recordatorios pendientes"):(t.classList.add("deshabilitado"),t.title="No hay recordatorios pendientes para enviar"))}function mostrarDetallesCita(){const e=this.value,o=document.getElementById("detalles-cita");if(!e)return void o.classList.add("oculto");const r=this.options[this.selectedIndex].textContent,t=r.includes("Cliente:")?r.split("Cliente:")[1].split("-")[0].trim():"No disponible",a=r.includes("Fecha:")?r.split("Fecha:")[1].trim():"No disponible";o.innerHTML=`\n        <h3>Detalles de la Cita</h3>\n        <p><strong>ID:</strong> <span class="valor-destacado">${e}</span></p>\n        <p><strong>Cliente:</strong> <span class="valor-destacado">${t}</span></p>\n        <p><strong>Fecha:</strong> <span class="valor-destacado">${a}</span></p>\n        <p class="aviso">Se enviará un recordatorio al cliente para esta cita</p>\n    `,o.classList.remove("oculto")}function enviarRecordatorio(e){confirm("¿Deseas enviar este recordatorio ahora?")&&fetch("/admin/enviar-recordatorio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then((e=>e.json())).then((e=>{e.resultado?(mostrarAlerta("Recordatorio enviado exitosamente","exito",".contenedor-alertas"),setTimeout((()=>location.reload()),2e3)):mostrarAlerta(e.mensaje||"Error al enviar el recordatorio","error",".contenedor-alertas")})).catch((e=>{console.error("Error:",e),mostrarAlerta("Error al enviar el recordatorio","error",".contenedor-alertas")}))}function eliminarRecordatorio(e){confirm("¿Estás seguro de eliminar este recordatorio?")&&fetch("/admin/eliminar-recordatorio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then((e=>e.json())).then((e=>{e.resultado?(mostrarAlerta("Recordatorio eliminado exitosamente","exito",".contenedor-alertas"),setTimeout((()=>location.reload()),2e3)):mostrarAlerta(e.mensaje||"Error al eliminar el recordatorio","error",".contenedor-alertas")})).catch((e=>{console.error("Error:",e),mostrarAlerta("Error al eliminar el recordatorio","error",".contenedor-alertas")}))}function mostrarAlerta(e,o,r){const t=document.querySelector(`${r} .alerta`);t&&t.remove();const a=document.createElement("DIV");a.classList.add("alerta",o),a.textContent=e,document.querySelector(r).appendChild(a),setTimeout((()=>{a.remove()}),2e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarRecordatorios()}));