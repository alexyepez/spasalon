document.addEventListener("DOMContentLoaded",(()=>{const e=window.clienteId;async function t(e){const n=await fetch(`/api/familiares?cliente_id=${e}`),i=await n.json();0===i.length&&o("No hay familiares registrados","info",".familiares");const l=document.getElementById("lista-familiares");l.innerHTML="",i.forEach((n=>{const i=document.createElement("li");i.textContent=`${n.nombre} ${n.apellido?n.apellido:""} (${n.parentesco})`;const m=document.createElement("button");m.textContent="Editar",m.className="boton",m.onclick=()=>a(n);const r=document.createElement("button");r.textContent="Eliminar",r.className="boton boton-cancelar",r.onclick=async()=>{const a=`¿Eliminar a ${n.nombre} ${n.apellido?n.apellido:""} (${n.parentesco})?`;if(confirm(a)){const a=new FormData;a.append("id",n.id);const i=await fetch("/api/familiares/eliminar",{method:"POST",body:a});(await i.json()).resultado?(o("Familiar eliminado exitosamente","exito",".familiares"),await t(e)):o("Ocurrió un error al eliminar el familiar","error",".familiares")}},i.appendChild(m),i.appendChild(r),l.appendChild(i)})),function(e,t){const a=document.getElementById("persona"),n=a.options[0].textContent;a.innerHTML="";const o=document.createElement("option");o.value=t,o.textContent=n,a.appendChild(o),e.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=`${e.nombre} ${e.apellido?e.apellido:""} (${e.parentesco})`,a.appendChild(t)}))}(i,e)}function a(e=null){document.getElementById("modal-familiar").style.display="block",document.getElementById("familiar-id").value=e?e.id:"",document.getElementById("familiar-nombre").value=e?e.nombre:"",document.getElementById("familiar-apellido").value=e&&e.apellido||"",document.getElementById("familiar-parentesco").value=e?e.parentesco:"",document.getElementById("familiar-fecha-nacimiento").value=e&&e.fecha_nacimiento||"",document.getElementById("familiar-telefono").value=e&&e.telefono||""}function n(){document.getElementById("modal-familiar").style.display="none",document.getElementById("form-familiar").reset(),document.getElementById("alerta-modal").innerHTML=""}function o(e,t,a){const n=document.querySelector(a),o=n.querySelector(".alerta");o&&o.remove();const i=document.createElement("DIV");i.textContent=e,i.classList.add("alerta",t),n.appendChild(i),setTimeout((()=>{i.remove()}),3e3)}t(e),document.getElementById("btn-agregar-familiar").onclick=()=>a(),document.getElementById("btn-cerrar-modal").onclick=n,document.getElementById("form-familiar").onsubmit=async function(a){a.preventDefault();const i=new FormData(this);i.append("cliente_id",e);let l="/api/familiares/crear",m="Familiar agregado exitosamente";i.get("id")&&(l="/api/familiares/actualizar",m="Familiar actualizado exitosamente");const r=await fetch(l,{method:"POST",body:i}),c=await r.json();c.resultado?(n(),await t(e),console.log(document.querySelector("#alerta-familiares")),o(m,"exito","#alerta-familiares")):c.mensaje&&o(c.mensaje,"error","#alerta-modal")}}));